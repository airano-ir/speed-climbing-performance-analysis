# راهنمای پردازش دسته‌ای ویدیوهای سنگ‌نوردی سرعت

این راهنما نحوه استفاده از اسکریپت `scripts/batch_process_races.py` برای پردازش چندین ویدیوی مسابقه به صورت خودکار را توضیح می‌دهد.

## پیش‌نیازها

مطمئن شوید که محیط مجازی پایتون فعال است و تمام وابستگی‌ها نصب شده‌اند:

```bash
pip install -r requirements.txt
```

## نحوه استفاده

اسکریپت را می‌توانید با دستور زیر اجرا کنید:

```bash
python scripts/batch_process_races.py --input-dir "مسیر/پوشه/ویدیوها" --output-dir "مسیر/خروجی"
```

### پارامترها:

*   `--input-dir`: مسیری که فایل‌های ویدیویی در آن قرار دارند (پیش‌فرض: `data/raw`).
*   `--output-dir`: مسیری که نتایج در آن ذخیره می‌شوند (پیش‌فرض: `data/processed/batch_results`).
*   `--route-map`: مسیر فایل نقشه مسیر (پیش‌فرض: `configs/ifsc_route_coordinates.json`).
*   `--extensions`: پسوند فایل‌های ویدیویی (پیش‌فرض: `.mp4 .mov .avi .mkv`).

### مثال اجرا:

```bash
python scripts/batch_process_races.py --input-dir data/raw --output-dir data/results_2025
```

## خروجی‌ها

برای هر ویدیو، یک فایل JSON و در نهایت یک فایل خلاصه CSV تولید می‌شود:

1.  **فایل‌های JSON**: به ازای هر ویدیو (مثلاً `race001_results.json`) شامل جزئیات کامل مسیر، سرعت و زمان برای هر دو ورزشکار.
2.  **فایل `batch_summary.csv`**: یک جدول خلاصه شامل ستون‌های زیر:
    *   `video`: نام فایل ویدیو.
    *   `status`: وضعیت اجرا (`success` یا `failed`).
    *   `left_dist`: مسافت طی شده توسط ورزشکار سمت چپ.
    *   `left_vel`: سرعت متوسط ورزشکار سمت چپ.
    *   `right_dist`: مسافت طی شده توسط ورزشکار سمت راست.
    *   `right_vel`: سرعت متوسط ورزشکار سمت راست.
    *   `processing_time`: زمان پردازش.
    *   `error`: متن خطا در صورت شکست.

## نکات مهم

*   **نورپردازی**: مطمئن شوید ویدیوها کیفیت مناسبی دارند و گیره‌های قرمز به وضوح مشخص هستند.
*   **زاویه دوربین**: سیستم برای دوربین‌های ثابت طراحی شده است. لرزش شدید ممکن است باعث خطا در کالیبراسیون شود.
*   **خطاها**: اگر پردازش یک ویدیو شکست بخورد، اسکریپت متوقف نمی‌شود و به سراغ ویدیوی بعدی می‌رود. خطا در فایل CSV ثبت می‌شود.
